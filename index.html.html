<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ูุบุณูุฉ ุงูุณูุงุฑุงุช ุงูุขูู</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .header {
            background: linear-gradient(135deg, #1e88e5, #0d47a1);
            color: white;
            padding: 20px 0;
            border-radius: 0 0 20px 20px;
        }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            border: none;
        }
    </style>
</head>
<body>
    <!-- ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู -->
    <div id="loginScreen">
        <div class="login-container">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="card-title">๐ ุชุณุฌูู ุงูุฏุฎูู</h3>
                    <p class="text-muted">ูุธุงู ุฅุฏุงุฑุฉ ูุบุณูุฉ ุงูุณูุงุฑุงุช</p>
                    
                    <form id="loginForm" class="mt-4">
                        <div class="mb-3">
                            <input type="text" class="form-control" id="username" placeholder="ุงุณู ุงููุณุชุฎุฏู" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" class="form-control" id="password" placeholder="ูููุฉ ุงููุฑูุฑ" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">ุฏุฎูู</button>
                    </form>
                    
                    <div class="mt-3">
                        <small class="text-muted">
                            ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ:<br>
                            ุงููุณุชุฎุฏู: admin | ูููุฉ ุงููุฑูุฑ: 123456
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ุงูุชุทุจูู ุงูุฑุฆูุณู (ุณูุธูุฑ ุจุนุฏ ุงูุชุณุฌูู) -->
    <div id="appScreen" class="hidden">
        <div class="header text-center mb-4">
            <div class="container">
                <h1>ูุธุงู ุฅุฏุงุฑุฉ ูุบุณูุฉ ุงูุณูุงุฑุงุช</h1>
                <button class="btn btn-light btn-sm mt-2" onclick="logout()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
            </div>
        </div>

        <div class="container">
            <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
                <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#add-customer">ุฅุถุงูุฉ ุนููู</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#customers">ุงูุนููุงุก</button>
                </li>
            </ul>

            <div class="tab-content">
                <!-- ุฅุถุงูุฉ ุนููู -->
                <div class="tab-pane fade show active" id="add-customer">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ</h5>
                            <form id="customerForm">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">ุงุณู ุงูุนููู</label>
                                        <input type="text" class="form-control" id="customerName" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">ุฑูู ุงููุงุชู</label>
                                        <input type="tel" class="form-control" id="customerPhone" required>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">ููุฏูู ุงูุณูุงุฑุฉ</label>
                                        <input type="text" class="form-control" id="carModel" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">ุฑูู ุงูููุญุฉ</label>
                                        <input type="text" class="form-control" id="carPlate" required>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">ููุน ุงูุงุดุชุฑุงู</label>
                                        <select class="form-select" id="subscriptionType" required>
                                            <option value="ุดูุฑู">ุดูุฑู</option>
                                            <option value="ุฑุจุน ุณููู">ุฑุจุน ุณููู</option>
                                            <option value="ุณููู">ุณููู</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label>
                                        <input type="date" class="form-control" id="startDate" required>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">ุฅุถุงูุฉ ุงูุนููู</button>
                            </form>
                        </div>
                    </div>

                    <div class="card mt-4 hidden" id="qrCard">
                        <div class="card-body text-center">
                            <h5>QR ููุฏ ุงูุนููู</h5>
                            <div id="qrcode"></div>
                            <button class="btn btn-outline-primary mt-3" onclick="printQR()">ุทุจุงุนุฉ ุงูููุฏ</button>
                        </div>
                    </div>
                </div>

                <!-- ูุงุฆูุฉ ุงูุนููุงุก -->
                <div class="tab-pane fade" id="customers">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">ูุงุฆูุฉ ุงูุนููุงุก</h5>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>ุงูุงุณู</th>
                                            <th>ุงููุงุชู</th>
                                            <th>ุงูุณูุงุฑุฉ</th>
                                            <th>ุงูููุญุฉ</th>
                                            <th>ุงูุงุดุชุฑุงู</th>
                                            <th>ุงูููุงูุฉ</th>
                                            <th>ุงูุญุงูุฉ</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTable">
                                        <!-- ุณูุชู ููุคูุง ุจุงูุจูุงูุงุช -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ุจูุงูุงุช ุงููุณุชุฎุฏููู ุงููุณููุญ ููู
        const users = {
            "admin": "123456",
            "ููุธู1": "111111",
            "ููุธู2": "222222"
        };

        // ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
        function checkAuth() {
            const savedUser = localStorage.getItem('carWashUser');
            const savedTime = localStorage.getItem('carWashLoginTime');
            
            if (savedUser && savedTime) {
                // ุงูุชุญูู ูู ุฃู ุงูุฌูุณุฉ ูู ุชูุชูู (24 ุณุงุนุฉ)
                const loginTime = parseInt(savedTime);
                const currentTime = new Date().getTime();
                const hoursDiff = (currentTime - loginTime) / (1000 * 60 * 60);
                
                if (hoursDiff < 24) {
                    showApp();
                    return true;
                } else {
                    logout();
                }
            }
            return false;
        }

        // ุชุณุฌูู ุงูุฏุฎูู
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (users[username] && users[username] === password) {
                // ุญูุธ ุจูุงูุงุช ุงูุฌูุณุฉ
                localStorage.setItem('carWashUser', username);
                localStorage.setItem('carWashLoginTime', new Date().getTime().toString());
                
                showApp();
                alert('ูุฑุญุจุงู ' + username);
            } else {
                alert('ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ!');
            }
        });

        // ุฅุธูุงุฑ ุงูุชุทุจูู
        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
            loadCustomers();
        }

        // ุชุณุฌูู ุงูุฎุฑูุฌ
        function logout() {
            localStorage.removeItem('carWashUser');
            localStorage.removeItem('carWashLoginTime');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('appScreen').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        // ุฅุฏุงุฑุฉ ุงูุนููุงุก
        let customers = JSON.parse(localStorage.getItem('carWashCustomers')) || [];

        // ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const customer = {
                id: 'CW' + Date.now(),
                name: document.getElementById('customerName').value,
                phone: document.getElementById('customerPhone').value,
                carModel: document.getElementById('carModel').value,
                carPlate: document.getElementById('carPlate').value,
                subscription: document.getElementById('subscriptionType').value,
                startDate: document.getElementById('startDate').value,
                endDate: calculateEndDate(),
                status: 'ูุดุท'
            };
            
            customers.push(customer);
            localStorage.setItem('carWashCustomers', JSON.stringify(customers));
            
            generateQRCode(customer.id);
            document.getElementById('qrCard').classList.remove('hidden');
            document.getElementById('customerForm').reset();
            
            alert('ุชู ุฅุถุงูุฉ ุงูุนููู ุจูุฌุงุญ!');
            loadCustomers();
        });

        // ุญุณุงุจ ุชุงุฑูุฎ ุงูุงูุชูุงุก
        function calculateEndDate() {
            const startDate = new Date(document.getElementById('startDate').value);
            const subscriptionType = document.getElementById('subscriptionType').value;
            let endDate = new Date(startDate);
            
            switch(subscriptionType) {
                case 'ุดูุฑู': endDate.setMonth(endDate.getMonth() + 1); break;
                case 'ุฑุจุน ุณููู': endDate.setMonth(endDate.getMonth() + 3); break;
                case 'ุณููู': endDate.setFullYear(endDate.getFullYear() + 1); break;
            }
            
            return endDate.toISOString().split('T')[0];
        }

        // ุฅูุดุงุก QR ููุฏ
        function generateQRCode(customerId) {
            const qrcodeElement = document.getElementById('qrcode');
            qrcodeElement.innerHTML = '';
            
            QRCode.toCanvas(qrcodeElement, customerId, { width: 200 }, function(error) {
                if (error) {
                    qrcodeElement.innerHTML = '<p>ููุฏ ุงูุนููู: ' + customerId + '</p>';
                }
            });
        }

        // ุชุญููู ุงูุนููุงุก
        function loadCustomers() {
            const table = document.getElementById('customersTable');
            table.innerHTML = '';
            
            customers.forEach(customer => {
                const status = new Date(customer.endDate) > new Date() ? 'ูุดุท' : 'ููุชูู';
                const statusClass = status === 'ูุดุท' ? 'text-success' : 'text-danger';
                
                const row = `
                    <tr>
                        <td>${customer.name}</td>
                        <td>${customer.phone}</td>
                        <td>${customer.carModel}</td>
                        <td>${customer.carPlate}</td>
                        <td>${customer.subscription}</td>
                        <td>${customer.endDate}</td>
                        <td class="${statusClass}">${status}</td>
                    </tr>
                `;
                table.innerHTML += row;
            });
        }

        // ุทุจุงุนุฉ QR ููุฏ
        function printQR() {
            window.print();
        }

        // ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            // ุชุนููู ุชุงุฑูุฎ ุงูููู ูุงูุชุฑุงุถู
            document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
            
            // ุงูุชุญูู ูู ุงููุตุงุฏูุฉ
            if (!checkAuth()) {
                document.getElementById('loginScreen').classList.remove('hidden');
            }
        });
    </script>
</body>
</html>